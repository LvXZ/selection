<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="../static/images/logo.ico" th:href="@{images/logo.ico}" type="image/x-icon"/>
    <link rel="stylesheet" href="../static/resources/materialize/css/materialize.css" media="screen,projection" th:href="@{resources/materialize/css/materialize.css}">    <link rel="stylesheet" type="text/css" href="../static/css/login.css" th:href="@{css/login.css}">
    <link rel="stylesheet" type="text/css" href="../static/css/index.css" th:href="@{css/index.css}">
    <script src="../static/js/constant.js" th:src="@{js/constant.js}"></script>


    <!--<link rel="stylesheet" href="webjars/bootstrap/3.3.7/css/bootstrap.min.css" />
    <script src="webjars/jquery/3.1.1/jquery.min.js"></script>
    <script src="webjars/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->


    <link rel="stylesheet" type="text/css" href="../static/resources/bootstrap-3.3.7/css/bootstrap.min.css" th:href="@{resources/bootstrap-3.3.7/css/bootstrap.min.css}">
    <script src="../static/js/jquery-3.2.1.min.js" th:src="@{js/jquery-3.2.1.min.js}"></script>
    <script src="../static/resources/bootstrap-3.3.7/js/bootstrap.min.js" th:src="@{resources/bootstrap-3.3.7/js/bootstrap.min.js}"></script>

    <script src="../static/js/js.cookie.js" th:src="@{js/js.cookie.js}"></script>

    <title>管理员界面</title>

    <style>
        @font-face {
            font-family: 'iconfont';  /* project id 738044 */
            src: url('//at.alicdn.com/t/font_738044_t4gao2pkol.eot');
            src: url('//at.alicdn.com/t/font_738044_t4gao2pkol.eot?#iefix') format('embedded-opentype'),
            url('//at.alicdn.com/t/font_738044_t4gao2pkol.woff') format('woff'),
            url('//at.alicdn.com/t/font_738044_t4gao2pkol.ttf') format('truetype'),
            url('//at.alicdn.com/t/font_738044_t4gao2pkol.svg#iconfont') format('svg');
        }

        .iconfont {/*对阿里图标进行修饰*/
            /*color: #c12e2a;*/
            font-family:"iconfont" !important;
            font-style:normal;
            /* font-weight: bold;!*加粗*!*/
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>

<body onload="jumpLogin()" style="background-color:#39221e">

<div class="container">
    <div class="row clearfix">
        <div class="col-md-4 column pull-left" id="logo-title">
            <h1>
                管理员管理界面
            </h1>
        </div>

    </div>
    <div class="row clearfix">
        <div class="col-md-12 column">
            <ul class="nav nav-pills">
                <li>
                    <a href="/lvxz/index_admin">首页</a>
                </li>
                <li>
                    <a href="/lvxz/inspect_admin">审查毕设申请</a>
                </li>
                <li>
                    <a href="/lvxz/insert1_admin">单个用户注册</a>
                </li>
                <li>
                    <a href="/lvxz/insert2_admin">文件导入注册</a>
                </li>
                <li class="active">
                    <a href="#">用户账号冻结</a>
                </li>
                <li>
                    <a href="/lvxz/headline_admin">头条消息发布</a>
                </li>
                <li class="dropdown pull-right">
                    <input id="user_name" value="未登录" readonly="true"/>
                </li>
                <li class="dropdown pull-right">
                    <input id="user_id" value="" readonly="true"/>
                </li>
                <li class="dropdown pull-right disabled">
                    <a href="#"></a>
                </li>
                <li class="dropdown pull-right">
                    <a href="#" data-toggle="dropdown" class="dropdown-toggle">个人设置<strong class="caret"></strong></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a onclick="showAdminInfo()">修改信息</a>
                        </li>
                        <li>
                            <a onclick="showAdminPassword()">修改密码</a>
                        </li>
                        <li class="divider">
                        </li>
                        <li>
                            <a onclick="showDeleteCookies()">退出登录</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div class="row clearfix">
        <div class="col-md-2 column">
        </div>
        <div class="col-md-8 column">
            <div class="jumbotron">

                <form id="form1" role="form" method="POST" enctype="multipart/form-data" action="/lvxz/admin/read_excel" class="navbar-form navbar-left">
                    <div class="radio">
                        <label class="radio-inline">
                            <input type="radio" name="radio" id="radio1" value="student" checked> 学生
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="radio" id="radio2"  value="teacher"> 老师
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="radio" id="radio3"  value="admin"> 管理员
                        </label>
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                        <input class="form-control" id="block_user_id" type="number" placeholder="ID"/>
                    </div>
                    <button type="button" class="btn btn-small btn-primary" onclick="block_user()">
                        <i class="iconfont">&#xe616;</i>冻结
                    </button>
                    <button type="button" class="btn btn-small btn-primary" onclick="unblock_user()">
                        <i class="iconfont">&#xe6a0;</i>解冻
                    </button>
                </form>

                <br/><br/><br/>
                <aaa>

                </aaa>
                <button type="button" onclick="admin_insert()" id="en_insert" name="" style="display:none" class="btn btn-warning pull-right" data-toggle="tooltip" data-placement="left" title="请确定是否一一对应"><i class="glyphicon glyphicon-ok">确定添加</i></button>
            </div>
        </div>
        <div class="col-md-2 column">


            <!--修改个人信息框-->
            <div class="modal fade" id="modal-container-287888" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
                <div class="modal-dialog" role="document">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 class="modal-title">
                            信息修改
                        </h3>
                    </div>

                    <div class="modal-body">
                        <div class="login-box-body">

                            <div class="input">
                                <input  class="form-control" id="update_InfoId" type="text" value="未登录" readonly="true"/>
                            </div>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                <input class="form-control" id="birthday" type="date" placeholder="出生日期"/>
                            </div>

                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-earphone"></i></span>
                                <input  class="form-control" id="phone" type="number" placeholder="手机"/>
                            </div>

                            <div class="input" style="text-align:center">
                                <button class="btn btn-default btn-center" data-dismiss="modal">取消</button>
                                <button class="btn btn-primary btn-center" onclick="updateAdminInfo()">修改</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!--修改密码框-->
            <div class="modal fade" id="modal-container-287808" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
                <div class="modal-dialog" role="document">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 class="modal-title">
                            密码修改
                        </h3>
                    </div>

                    <div class="modal-body">
                        <div class="login-box-body">

                            <div class="input">
                                <input  class="form-control" id="update_PasswordId" type="text" value="未登录" readonly="true"/>
                            </div>

                            <div class="input-group">
                                <span class="input-group-addon"><i class="iconfont">&#xe62f;</i></span>
                                <input class="form-control" id="old_password" type="password" placeholder="旧密码"/>
                            </div>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                <input  class="form-control" id="new_password" type="password" placeholder="新密码"/>
                            </div>

                            <div class="input" style="text-align:center">
                                <button class="btn btn-default btn-center" data-dismiss="modal">取消</button>
                                <button class="btn btn-primary btn-center" onclick="updateAdminPassword()">修改</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


</div>

</body>

<script>

    /*网页生成时，验证是否登录的跳传*/
    function jumpLogin() {

        if(!Cookies.get('admin_ObjJson')){
            alert("您还未登陆！请登陆");
            //window.open("/lvxz/login",'_self');
        }else{
            var jsonValue = JSON.parse(Cookies.get('admin_ObjJson'));
            getUser(jsonValue);
        }

    }

    <!-- 获取登录信息，并修改登录栏-->
    function getUser(jsonValue){
        $('#user_name').val(jsonValue.adminName);
        $('#user_id').val(jsonValue.adminID);
    }

    /*修改个人信息框出现*/
    function showAdminInfo() {

        $('#update_InfoId').val($('#user_id').val()+"   "+$('#user_name').val());

        $('#modal-container-287888').modal('show');
    }

    /*修改个人信息函数*/
    function updateAdminInfo() {

        var adminID = $('#user_id').val();
        var birthday = $('#birthday').val();
        var phone = $('#phone').val();

        if(adminID.length!=0){

            var updatePasswordURL = "/lvxz/admin/update_info";
            var objJson = {
                "adminID":parseInt(adminID),
                "birthday":birthday,
                "phone":phone
            };

            $.ajax({
                type:"POST",
                url: updatePasswordURL,
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                data: JSON.stringify(objJson),
                async:true,
                success: function (response) {
                    if(response.code == 1){
                        alert(response.msg);
                        location.reload();//重新加载
                    } else {
                        alert(response.msg);
                    }
                },
                error: function (data){
                    alert("访问失败，请检查网络、路径......");
                }
            });

        } else {
            alert("未登录！");
        }
    }



    /*修改密码框出现*/
    function showAdminPassword(){

        $('#update_PasswordId').val($('#user_id').val()+"   "+$('#user_name').val());

        $('#modal-container-287808').modal('show');
    }

    /*修改密码函数*/
    function updateAdminPassword(){

        var adminID = $('#user_id').val();
        var oldPassword = $('#old_password').val();
        var newPassword = $('#new_password').val();

        if(adminID.length!=0  && oldPassword.length!=0 && newPassword.length!=0) {

            var updatePasswordURL = "/lvxz/admin/update_password";

            var objJson = {
                "adminID":parseInt(adminID),
                "password":oldPassword,
                "new_password":newPassword
            };

            $.ajax({
                type:"POST",
                url: updatePasswordURL,
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                data: JSON.stringify(objJson),
                async:true,
                success: function (response) {
                    if(response.code == 1){
                        alert(response.msg);
                        location.reload();//重新加载
                    } else {
                        alert(response.msg);
                    }
                },
                error: function (data){
                    alert("访问失败，请检查网络、路径......");
                }
            });

        } else {
            alert("存在输入为空！");
        }
    }


    /*提示出现退出*/
    function showDeleteCookies() {
        if(confirm("您确定退出！")) {
            deleteCookies();
        }else{

        }
    }

    /*退出登录，消除cookies*/
    function deleteCookies() {
        Cookies.remove('admin_ObjJson', { path: '' });
        window.open("/lvxz/login",'_self');
        alert("已注销");
    }


    //冻结
    function block_user() {

        var userID = $('#user_id').val(),
            blockUserID = $('#block_user_id').val(),
            userRadio = $('input[name="radio"]:checked').val();


        if(userID.length!=0) {

            var blockURL = "/lvxz/admin/blocked_user";
            var objJson;

            switch (userRadio) {
                case "student":{
                    objJson = {
                        "radio":"student",
                        "studentID":parseInt(blockUserID),
                        "enableStatus":"0"
                    };
                }break;

                case "teacher":{
                    objJson = {
                        "radio":"teacher",
                        "teacherID":parseInt(blockUserID),
                        "enableStatus":"0"
                    };
                }break;

                case "admin":{
                    objJson = {
                        "radio":"admin",
                        "adminID":parseInt(blockUserID),
                        "enableStatus":"0"
                    };
                }break;

            }

            $.ajax({
                type:"POST",
                url: blockURL,
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                data: JSON.stringify(objJson),
                async:true,
                success: function (response) {
                    if(response.code == 1){
                        alert(response.msg);

                    } else {
                        alert(response.msg);
                    }
                },
                error: function (data){
                    alert("访问失败，请检查网络、路径......");
                }
            });


        } else {
            alert("存在输入为空！");
        }

    }

    //解冻
    function unblock_user() {
        var userID = $('#user_id').val(),
            blockUserID = $('#block_user_id').val(),
            userRadio = $('input[name="radio"]:checked').val();


        if(userID.length!=0) {

            var blockURL = "/lvxz/admin/blocked_user";
            var objJson;

            switch (userRadio) {
                case "student":{
                    objJson = {
                        "radio":"student",
                        "studentID":parseInt(blockUserID),
                        "enableStatus":"1"
                    };
                }break;

                case "teacher":{
                    objJson = {
                        "radio":"teacher",
                        "teacherID":parseInt(blockUserID),
                        "enableStatus":"1"
                    };
                }break;

                case "admin":{
                    objJson = {
                        "radio":"admin",
                        "adminID":parseInt(blockUserID),
                        "enableStatus":"1"
                    };
                }break;

            }

            $.ajax({
                type:"POST",
                url: blockURL,
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                data: JSON.stringify(objJson),
                async:true,
                success: function (response) {
                    if(response.code == 1){
                        alert(response.msg);

                    } else {
                        alert(response.msg);
                    }
                },
                error: function (data){
                    alert("访问失败，请检查网络、路径......");
                }
            });


        } else {
            alert("存在输入为空！");
        }
    }


</script>

</html>