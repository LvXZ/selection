<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">

    <link rel="shortcut icon" href="../static/images/logo.ico" th:href="@{images/logo.ico}" type="image/x-icon"/>
    <link rel="stylesheet" href="../static/resources/materialize/css/materialize.min.css" media="screen,projection" th:href="@{resources/materialize/css/materialize.min.css}">
    <link rel="stylesheet" type="text/css" href="../static/css/login.css" th:href="@{css/login.css}">
    <link rel="stylesheet" type="text/css" href="../static/css/index.css" th:href="@{css/index.css}">
    <script src="../static/js/constant.js" th:src="@{js/constant.js}"></script>


    <!--<link rel="stylesheet" href="webjars/bootstrap/3.3.7/css/bootstrap.min.css" />
    <script src="webjars/jquery/3.1.1/jquery.min.js"></script>
    <script src="webjars/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->


    <link rel="stylesheet" type="text/css" href="../static/resources/bootstrap-3.3.7/css/bootstrap.min.css" th:href="@{resources/bootstrap-3.3.7/css/bootstrap.min.css}">
    <script src="../static/js/jquery-3.2.1.min.js" th:src="@{js/jquery-3.2.1.min.js}"></script>
    <script src="../static/resources/bootstrap-3.3.7/js/bootstrap.min.js" th:src="@{resources/bootstrap-3.3.7/js/bootstrap.min.js}"></script>

    <script src="../static/js/js.cookie.js" th:src="@{js/js.cookie.js}"></script>

    <title>教师界面</title>
</head>

<body onload="jumpLogin()" style="background-color:#39221e">

    <div class="container">
        <div class="row clearfix">
            <div class="col-md-4 column pull-left" id="logo-title">
                <h1>
                    老师管理界面
                </h1>
            </div>

        </div>
        <div class="row clearfix">
            <div class="col-md-12 column">
                <ul class="nav nav-pills">
                    <li class="active">
                        <a href="#">首页</a>
                    </li>
                    <li>
                        <a href="upload_teacher.html">布置作业</a>
                    </li>
                    <li>
                        <a href="download_teacher.html">审批作业</a>
                    </li>
                    <li class="dropdown pull-right">
                        <input id="user_name" value="未登录" readonly="true"/>
                    </li>
                    <li class="dropdown pull-right">
                        <input id="user_id" value="" readonly="true"/>
                    </li>
                    <li class="dropdown pull-right disabled">
                        <a href="#"></a>
                    </li>
                    <li class="dropdown pull-right">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle">个人设置<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a onclick="showTeacherInfo()">修改信息</a>
                            </li>
                            <li>
                                <a onclick="showTeacherPassword()">修改密码</a>
                            </li>
                            <li class="divider">
                            </li>
                            <li>
                                <a onclick="showDeleteCookies()">退出登录</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div class="row clearfix">
            <div class="col-md-2 column">
            </div>
            <div class="col-md-8 column">
                <div class="jumbotron">
                    <h1>
                        PRD Tech
                    </h1>
                    <p>
                        Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
                    </p>
                    <p>
                        <a class="btn" href="#">View details »</a>
                    </p>
                </div>
            </div>
            <div class="col-md-2 column">


                <!--修改个人信息框-->
                <div class="modal fade" id="modal-container-287888" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h3 class="modal-title">
                                信息修改
                            </h3>
                        </div>

                        <div class="modal-body">
                            <div class="login-box-body">

                                <div class="input">
                                    <input  class="form-control" id="update_InfoId" type="text" value="未登录" readonly="true"/>
                                </div>

                                <div class="input">
                                    <input class="form-control" id="birthday" type="date" placeholder="出生日期"/>
                                </div>
                                <div class="input">
                                    <input  class="form-control" id="phone" type="number" placeholder="手机"/>
                                </div>
                                <div class="input">
                                    <input  class="form-control" id="qq" type="number" placeholder="QQ"/>
                                </div>

                                <div class="input" style="text-align:center">
                                    <button class="btn btn-default btn-center" data-dismiss="modal">取消</button>
                                    <button class="btn btn-primary btn-center" onclick="updateTeacherInfo()">修改</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--修改密码框-->
                <div class="modal fade" id="modal-container-287808" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h3 class="modal-title">
                                密码修改
                            </h3>
                        </div>

                        <div class="modal-body">
                            <div class="login-box-body">

                                <div class="input">
                                    <input  class="form-control" id="update_PasswordId" type="text" value="未登录" readonly="true"/>
                                </div>

                                <div class="input">
                                    <input class="form-control" id="old_password" type="password" placeholder="旧密码"/>
                                </div>
                                <div class="input">
                                    <input  class="form-control" id="new_password" type="password" placeholder="新密码"/>
                                </div>

                                <div class="input" style="text-align:center">
                                    <button class="btn btn-default btn-center" data-dismiss="modal">取消</button>
                                    <button class="btn btn-primary btn-center" onclick="updateTeacherPassword()">修改</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>


</body>

    <script>

        /*网页生成时，验证是否登录的跳传*/
        function jumpLogin() {

            if(!Cookies.get('teacher_ObjJson')){
                alert("您还未登陆！请登陆");
                window.open("http://"+ getLocalIP() +":1314/lvxz/login",'_self');
            }else{
                var jsonValue = JSON.parse(Cookies.get('teacher_ObjJson'));
                getUser(jsonValue);
            }

        }

        <!-- 获取登录信息，并修改登录栏-->
        function getUser(jsonValue){
            $('#user_name').val(jsonValue.teacherName);
            $('#user_id').val(jsonValue.teacherID);
        }


        /*修改个人信息框出现*/
        function showTeacherInfo() {
            $('#update_InfoId').val($('#user_id').val()+"   "+$('#user_name').val());
            $('#modal-container-287888').modal('show');
        }

        /*修改个人信息函数*/
        function updateTeacherInfo() {

            var teacherID = $('#user_id').val();
            var birthday = $('#birthday').val();
            var phone = $('#phone').val();
            var qq = $('#qq').val();

            if(teacherID.length!=0){

                var updatePasswordURL = "http://"+ getLocalIP() +":1314/lvxz/teacher/update_info";
                var objJson = {
                    "teacherID":parseInt(teacherID),
                    "birthday":birthday,
                    "phone":phone,
                    "teacherQQ":qq,
                };

                $.ajax({
                    type:"POST",
                    url: updatePasswordURL,
                    contentType: "application/json;charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(objJson),
                    async:true,
                    success: function (response) {
                        if(response.code == 104){
                            alert(response.msg);
                            location.reload();//重新加载
                        } else {
                            alert(response.msg);
                        }
                    },
                    error: function (data){
                        alert("访问失败，请检查网络、路径......");
                    }
                });

            } else {
                alert("未登录！");
            }
        }

        /*修改密码框出现*/
        function showTeacherPassword(){
            $('#update_PasswordId').val($('#user_id').val()+"   "+$('#user_name').val());
            $('#modal-container-287808').modal('show');
        }

        /*修改密码函数*/
        function updateTeacherPassword(){

            var teacherID = $('#user_id').val();
            var oldPassword = $('#old_password').val();
            var newPassword = $('#new_password').val();

            if(teacherID.length!=0  && oldPassword.length!=0 && newPassword.length!=0) {

                var updatePasswordURL = "http://"+ getLocalIP() +":1314/lvxz/teacher/update_password";

                var objJson = {
                    "teacherID":parseInt(teacherID),
                    "password":oldPassword,
                    "new_password":newPassword
                };

                $.ajax({
                    type:"POST",
                    url: updatePasswordURL,
                    contentType: "application/json;charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(objJson),
                    async:true,
                    success: function (response) {
                        if(response.code == 103){
                            alert(response.msg);
                            location.reload();//重新加载
                        } else {
                            alert(response.msg);
                        }
                    },
                    error: function (data){
                        alert("访问失败，请检查网络、路径......");
                    }
                });

            } else {
                alert("存在输入为空！");
            }
        }

        /*提示出现退出*/
        function showDeleteCookies() {
            if(confirm("您确定退出！")) {
                deleteCookies();
            }else{

            }
        }

        /*退出登录，消除cookies*/
        function deleteCookies() {
            //Cookies.remove('s_id', { path: '' });
            //Cookies.remove('s_account', { path: '' });
            //window.open('login.html','_self');
            alert("已注销");
        }

    </script>


</html>